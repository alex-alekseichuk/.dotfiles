#!/usr/bin/bash

name=$1
pass="${2:-Aing9ahg7vah2ah}"
admin="${PG_ADMIN_USER:-admin}"

psql -h localhost -U $admin -d postgres -c "CREATE USER ${name}_user WITH PASSWORD '$pass';"
psql -h localhost -U $admin -d postgres -c "CREATE DATABASE db_$name;"
psql -h localhost -U $admin -d postgres -c "GRANT ALL PRIVILEGES ON DATABASE db_$name TO ${name}_user;"
psql -h localhost -U $admin -d postgres -c "ALTER USER ${name}_user WITH SUPERUSER;"

PGHOST=localhost PGPORT=5432 PGDATABASE=db_$name PGUSER=${name}_user PGPASSWORD=$pass pgmigrate -c '' migrate -t latest

